---
import type { Post } from '@hotmetal/content-core';
import { formatDate } from '../../../lib/format';
import { getFirstTopic, backgroundImageStyle } from '../../../lib/post-utils';

interface Props {
  posts: Post[];
}

const { posts } = Astro.props;
---

{posts.length > 0 && (
  <section class="max-w-[var(--max-width-wide)] mx-auto px-6 py-12">
    <div class="flex justify-between items-center mb-6 pb-3 border-b-[3px] border-border-strong">
      <h2 class="font-display text-sm font-semibold uppercase tracking-[0.06em]">Explore More</h2>
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-0">
      {posts.slice(0, 4).map((post, i) => {
        const date = post.publishedAt ? formatDate(post.publishedAt) : null;
        const firstTopic = getFirstTopic(post);
        const bgStyle = backgroundImageStyle(post.featuredImage);

        return (
          <article
            class:list={[
              'animate-on-scroll pb-5',
              i < 3 && 'lg:border-r lg:border-border',
              i > 0 && 'lg:pl-5',
              i < 3 && 'lg:pr-5',
            ]}
          >
            {bgStyle && (
              <a href={`/${post.slug}`} class="block mb-3">
                <div
                  class="aspect-[16/10] bg-bg-card"
                  style={bgStyle}
                />
              </a>
            )}
            {firstTopic && (
              <p class="font-mono text-[11px] uppercase tracking-[0.08em] text-accent font-medium mb-1.5">
                {firstTopic}
              </p>
            )}
            <a href={`/${post.slug}`}>
              <h3 class="font-display text-[0.9375rem] font-bold leading-snug tracking-tight mb-1.5 hover:text-accent transition-colors">
                {post.title}
              </h3>
            </a>
            {date && post.publishedAt && (
              <time datetime={post.publishedAt} class="font-mono text-xs text-text-muted">
                {date}
              </time>
            )}
          </article>
        );
      })}
    </div>
  </section>
)}
