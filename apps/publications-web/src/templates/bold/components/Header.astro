---
interface Props {
  publicationName: string;
  logoUrl?: string | null;
}

const { publicationName, logoUrl } = Astro.props;

const currentPath = Astro.url.pathname;

const navLinks = [
  { href: '/', label: 'Home' },
  { href: '/rss', label: 'RSS' },
] as const;
---

<header class="border-b-[3px] border-border-strong bg-bg sticky top-0 z-50">
  <div class="max-w-[var(--max-width-wide)] mx-auto px-6 flex justify-between items-stretch h-[60px]">
    <div class="flex items-center gap-8">
      <a href="/" class="flex items-center gap-2 hover:opacity-80 transition-opacity">
        {logoUrl ? (
          <img src={logoUrl} alt={publicationName} class="h-7 w-auto" loading="eager" />
        ) : (
          <>
            <span class="w-7 h-7 bg-text flex items-center justify-center text-bg text-sm font-bold font-display">
              {publicationName.charAt(0)}
            </span>
            <span class="font-display text-lg font-bold tracking-tight">
              {publicationName}
            </span>
          </>
        )}
      </a>
    </div>

    <!-- Desktop nav -->
    <nav class="hidden md:flex items-stretch">
      {navLinks.map(({ href, label }) => (
        <a
          href={href}
          class:list={[
            'flex items-center px-4 border-l border-border font-display text-sm font-medium transition-all',
            currentPath === href
              ? 'text-accent bg-accent-light'
              : 'text-text-muted hover:bg-bg-card hover:text-text',
          ]}
        >
          {label}
        </a>
      ))}
    </nav>

    <!-- Mobile hamburger -->
    <button
      id="menu-toggle"
      class="md:hidden flex items-center p-2 -mr-2 text-text"
      aria-label="Open menu"
      aria-expanded="false"
      aria-controls="mobile-menu"
    >
      <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
      </svg>
    </button>
  </div>

  <!-- Mobile menu -->
  <div
    id="mobile-menu"
    role="dialog"
    aria-label="Navigation menu"
    aria-modal="true"
    class="fixed inset-0 z-40 bg-bg transform translate-x-full transition-transform duration-300 ease-in-out md:hidden"
  >
    <div class="flex items-center justify-between px-6 h-[60px] border-b-[3px] border-border-strong">
      <span class="font-display text-lg font-bold tracking-tight">{publicationName}</span>
      <button id="menu-close" class="p-2 -mr-2 text-text" aria-label="Close menu">
        <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>
    <ul class="px-6 py-8 space-y-0">
      {navLinks.map(({ href, label }) => (
        <li class="border-b border-border">
          <a
            href={href}
            class:list={[
              'block py-4 font-display text-xl font-bold transition-colors',
              currentPath === href ? 'text-accent' : 'text-text hover:text-accent',
            ]}
          >
            {label}
          </a>
        </li>
      ))}
    </ul>
  </div>
</header>

<script>
  function initMobileMenu() {
    const toggle = document.getElementById('menu-toggle');
    const close = document.getElementById('menu-close');
    const menu = document.getElementById('mobile-menu');
    if (!toggle || !close || !menu) return;
    const menuRef = menu;
    const toggleRef = toggle;

    function handleEscape(e: KeyboardEvent) {
      if (e.key === 'Escape') closeMenu();
    }

    function openMenu() {
      menuRef.classList.remove('translate-x-full');
      menuRef.classList.add('translate-x-0');
      toggleRef.setAttribute('aria-expanded', 'true');
      document.body.style.overflow = 'hidden';
      document.addEventListener('keydown', handleEscape);
      const firstLink = menuRef.querySelector('a');
      firstLink?.focus();
    }

    function closeMenu() {
      menuRef.classList.remove('translate-x-0');
      menuRef.classList.add('translate-x-full');
      toggleRef.setAttribute('aria-expanded', 'false');
      document.body.style.overflow = '';
      document.removeEventListener('keydown', handleEscape);
      toggleRef.focus();
    }

    toggle.addEventListener('click', openMenu);
    close.addEventListener('click', closeMenu);
    menuRef.querySelectorAll('a').forEach((link) => {
      link.addEventListener('click', closeMenu);
    });
  }

  initMobileMenu();
  document.addEventListener('astro:after-swap', initMobileMenu);
</script>
