---
import type { Post } from '@hotmetal/content-core';
import { formatDate } from '../../../lib/format';
import { getPreviewText, getFirstTopic } from '../../../lib/post-utils';

interface Props {
  posts: Post[];
}

const { posts } = Astro.props;

const items = posts.map((post, i) => ({
  post,
  num: String(i + 1).padStart(2, '0'),
  date: post.publishedAt ? formatDate(post.publishedAt) : null,
  firstTopic: getFirstTopic(post),
  preview: getPreviewText(post),
}));
---

<section class="max-w-[var(--max-width-wide)] mx-auto px-6">
  <div class="flex justify-between items-center py-5 border-b border-border">
    <h2 class="font-display text-sm font-semibold uppercase tracking-[0.06em]">Latest</h2>
    <span class="font-mono text-xs text-text-muted">
      {posts.length} {posts.length === 1 ? 'post' : 'posts'}
    </span>
  </div>

  {items.length > 0 ? (
    items.map(({ post, num, date, firstTopic, preview }) => (
      <a
        href={`/${post.slug}`}
        class="grid grid-cols-[50px_1fr] md:grid-cols-[60px_1fr_200px] gap-4 md:gap-6 items-start py-7 border-b border-border group hover:bg-bg-card transition-colors -mx-6 px-6 animate-on-scroll"
      >
        <span class="font-display text-3xl md:text-[2.5rem] font-bold text-border leading-none pt-0.5 group-hover:text-accent transition-colors">
          {num}
        </span>

        <div>
          {firstTopic && (
            <span class="inline-block font-mono text-[11px] uppercase tracking-[0.08em] text-accent font-medium bg-accent-light px-2 py-0.5 mb-1.5">
              {firstTopic}
            </span>
          )}
          <h3 class="font-display text-lg md:text-xl font-bold leading-snug tracking-tight mb-1.5 group-hover:text-accent transition-colors">
            {post.title}
          </h3>
          {preview && (
            <p class="text-sm text-text-muted leading-relaxed line-clamp-2">
              {preview}
            </p>
          )}
        </div>

        <div class="hidden md:block font-mono text-xs text-text-muted text-right pt-1">
          {date && post.publishedAt && (
            <time datetime={post.publishedAt} class="block mb-1">{date}</time>
          )}
        </div>
      </a>
    ))
  ) : (
    <div class="text-center py-16 text-text-muted">
      <p class="text-lg">No posts yet. Stay tuned!</p>
    </div>
  )}
</section>
