---
import { ClientRouter } from 'astro:transitions';
import HeadMeta from '../../../components/HeadMeta.astro';
import '../styles/theme.css';

interface Props {
  title: string;
  publicationName: string;
  description?: string;
  ogImage?: string;
  canonicalUrl?: string;
  accentColor?: string | null;
  ogType?: string;
  jsonLd?: Record<string, unknown>;
  rssUrl?: string;
  articlePublishedTime?: string;
  articleModifiedTime?: string;
  articleAuthor?: string;
  articleTags?: string[];
}

const {
  title,
  publicationName,
  description,
  ogImage,
  canonicalUrl,
  accentColor,
  ogType = 'website',
  jsonLd,
  rssUrl,
  articlePublishedTime,
  articleModifiedTime,
  articleAuthor,
  articleTags,
} = Astro.props;

const HEX_COLOR_PATTERN = /^#[0-9a-fA-F]{3,8}$/;
const validAccent = accentColor && HEX_COLOR_PATTERN.test(accentColor) ? accentColor : null;
const accentStyle = validAccent
  ? `--publication-accent: ${validAccent};`
  : undefined;
---

<html lang="en" style={accentStyle}>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Editorial fonts: Playfair Display, Source Serif 4, Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;0,800;0,900;1,400;1,500;1,600;1,700&family=Source+Serif+4:ital,opsz,wght@0,8..60,400;0,8..60,500;0,8..60,600;1,8..60,400;1,8..60,500&family=Inter:wght@400;500;600&display=swap"
      rel="stylesheet"
    />

    <HeadMeta
      {title}
      {publicationName}
      {description}
      {ogImage}
      {canonicalUrl}
      {ogType}
      {jsonLd}
      {rssUrl}
      {articlePublishedTime}
      {articleModifiedTime}
      {articleAuthor}
      {articleTags}
    />

    <ClientRouter />
  </head>
  <body class="min-h-screen flex flex-col">
    <slot />

    <script>
      function initScrollAnimations() {
        const observer = new IntersectionObserver(
          (entries) => {
            for (const entry of entries) {
              if (entry.isIntersecting) {
                entry.target.classList.add('is-visible');
                observer.unobserve(entry.target);
              }
            }
          },
          { threshold: 0.1 },
        );

        document
          .querySelectorAll('.animate-on-scroll')
          .forEach((el) => observer.observe(el));
      }

      initScrollAnimations();
      document.addEventListener('astro:after-swap', initScrollAnimations);
    </script>
  </body>
</html>
