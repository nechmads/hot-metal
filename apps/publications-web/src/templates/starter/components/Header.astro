---
interface Props {
  publicationName: string;
  logoUrl?: string | null;
}

const { publicationName, logoUrl } = Astro.props;

const currentPath = Astro.url.pathname;

const navLinks = [
  { href: '/', label: 'Home' },
  { href: '/rss', label: 'RSS' },
] as const;
---

<header class="sticky top-0 z-50 bg-white/95 backdrop-blur-sm border-b border-border">
  <nav class="mx-auto max-w-[var(--max-width-wide)] px-6 py-4 flex items-center justify-between">
    <a href="/" class="flex items-center gap-3 hover:opacity-80 transition-opacity">
      {logoUrl ? (
        <img
          src={logoUrl}
          alt={publicationName}
          class="h-8 w-auto"
          loading="eager"
        />
      ) : (
        <span class="text-xl font-bold tracking-tight text-text">
          {publicationName}
        </span>
      )}
    </a>

    <!-- Desktop nav -->
    <ul class="hidden md:flex items-center gap-8">
      {navLinks.map(({ href, label }) => (
        <li>
          <a
            href={href}
            class:list={[
              'text-sm font-medium transition-colors',
              currentPath === href
                ? 'text-accent'
                : 'text-text-muted hover:text-text',
            ]}
          >
            {label}
          </a>
        </li>
      ))}
    </ul>

    <!-- Mobile hamburger -->
    <button
      id="menu-toggle"
      class="md:hidden p-2 -mr-2 text-text"
      aria-label="Open menu"
      aria-expanded="false"
      aria-controls="mobile-menu"
    >
      <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
      </svg>
    </button>
  </nav>

  <!-- Mobile menu -->
  <div
    id="mobile-menu"
    role="dialog"
    aria-label="Navigation menu"
    aria-modal="true"
    class="fixed inset-0 z-40 bg-white transform translate-x-full transition-transform duration-300 ease-in-out md:hidden"
  >
    <div class="flex items-center justify-between px-6 py-4 border-b border-border">
      <a href="/" class="text-xl font-bold tracking-tight text-text">
        {publicationName}
      </a>
      <button
        id="menu-close"
        class="p-2 -mr-2 text-text"
        aria-label="Close menu"
      >
        <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>

    <ul class="px-6 py-8 space-y-6">
      {navLinks.map(({ href, label }) => (
        <li>
          <a
            href={href}
            class:list={[
              'block text-2xl font-semibold transition-colors',
              currentPath === href
                ? 'text-accent'
                : 'text-text hover:text-accent',
            ]}
          >
            {label}
          </a>
        </li>
      ))}
    </ul>
  </div>
</header>

<script>
  function initMobileMenu() {
    const toggle = document.getElementById('menu-toggle');
    const close = document.getElementById('menu-close');
    const menu = document.getElementById('mobile-menu');

    if (!toggle || !close || !menu) return;

    const menuRef = menu;
    const toggleRef = toggle;

    function handleEscape(e: KeyboardEvent) {
      if (e.key === 'Escape') closeMenu();
    }

    function openMenu() {
      menuRef.classList.remove('translate-x-full');
      menuRef.classList.add('translate-x-0');
      toggleRef.setAttribute('aria-expanded', 'true');
      document.body.style.overflow = 'hidden';
      document.addEventListener('keydown', handleEscape);
      const firstLink = menuRef.querySelector('a');
      firstLink?.focus();
    }

    function closeMenu() {
      menuRef.classList.remove('translate-x-0');
      menuRef.classList.add('translate-x-full');
      toggleRef.setAttribute('aria-expanded', 'false');
      document.body.style.overflow = '';
      document.removeEventListener('keydown', handleEscape);
      toggleRef.focus();
    }

    toggle.addEventListener('click', openMenu);
    close.addEventListener('click', closeMenu);

    menuRef.querySelectorAll('a').forEach((link) => {
      link.addEventListener('click', closeMenu);
    });
  }

  initMobileMenu();
  document.addEventListener('astro:after-swap', initMobileMenu);
</script>
