{
	"info": {
		"name": "Hot Metal — Content Scout",
		"description": "# Hot Metal Content Scout Service\n\nThe Content Scout is a Cloudflare Worker that discovers trending stories, generates blog post ideas, and optionally auto-writes posts for publications. It uses CF Queues and Workflows for durable execution.\n\n## Architecture\n\nThe Content Scout follows a **cron -> queue -> workflow** pipeline:\n\n1. **Cron Trigger** (`0 * * * *` UTC) — Fires hourly. Queries D1 for publications whose `next_scout_at` has passed and enqueues one message per due publication to the CF Queue.\n2. **CF Queue** — Receives `{ publicationId }` messages. Each message triggers a new ScoutWorkflow instance.\n3. **ScoutWorkflow** (Durable Execution) — A 6-step workflow that runs durably with automatic retries:\n   - **Step 1: Load Context** — Reads publication config from DAL (topics, tone, audience, auto-publish mode).\n   - **Step 2: Search** — Queries external news/trend APIs and web search for stories matching the publication's topic areas.\n   - **Step 3: Dedupe** — Compares discovered stories against previously generated ideas to avoid duplicates.\n   - **Step 4: Generate Ideas** — Uses an LLM to turn trending stories into concrete blog post ideas with titles, angles, and outlines.\n   - **Step 5: Store Ideas** — Writes the generated ideas to the ideas table via DAL.\n   - **Step 6: Auto-Write (Conditional)** — If the publication's auto-publish mode allows it, creates a writing session and triggers automatic drafting.\n\nManual triggers are also available via the REST API (documented below).\n\n## Authentication\n\nAll `/api/*` endpoints require an `Authorization: Bearer <token>` header. The token value must match the `API_KEY` secret configured on the content-scout worker.\n\nThe health endpoint is unauthenticated.\n\n## Endpoints Overview\n\n### Health\n| Method | Path | Auth | Description |\n|--------|------|------|-------------|\n| GET | `/health` | None | Service health check |\n\n### Scout Triggers\n| Method | Path | Auth | Description |\n|--------|------|------|-------------|\n| POST | `/api/scout/run` | Bearer | Trigger scout for a single publication |\n| POST | `/api/scout/run-all` | Bearer | Trigger scout for ALL publications |\n\n## Environment Variables\n\nThis collection uses variables from the Postman environment:\n- `SCOUT_BASE_URL` — Base URL of the content scout (e.g. `https://scout.hotmetalapp.com`)\n- `SCOUT_API_KEY` — API key for Bearer authentication (must match the API_KEY secret on the content-scout worker)\n\nSelect the appropriate environment before sending requests.",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"auth": {
		"type": "bearer",
		"bearer": [
			{ "key": "token", "value": "{{SCOUT_API_KEY}}", "type": "string" }
		]
	},
	"variable": [
		{
			"key": "publicationId",
			"value": "",
			"type": "string",
			"description": "Publication ID for chaining requests — set manually or from your D1 publications table"
		}
	],
	"item": [
		{
			"name": "Health",
			"description": "Service health check. No authentication required.",
			"item": [
				{
					"name": "Health Check",
					"description": "Returns the service status. Use this to verify the content scout worker is running.\n\n### Response\n\n```json\n{\n  \"status\": \"ok\",\n  \"service\": \"content-scout\"\n}\n```\n\nNo authentication required.",
					"request": {
						"auth": { "type": "noauth" },
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{SCOUT_BASE_URL}}/health",
							"host": ["{{SCOUT_BASE_URL}}"],
							"path": ["health"]
						}
					},
					"response": [
						{
							"name": "200 — Healthy",
							"status": "OK",
							"code": 200,
							"header": [
								{ "key": "Content-Type", "value": "application/json" }
							],
							"body": "{\n  \"status\": \"ok\",\n  \"service\": \"content-scout\"\n}"
						}
					]
				}
			]
		},
		{
			"name": "Scout Triggers",
			"description": "Manually trigger the content scout pipeline for one or all publications.\n\nThese endpoints enqueue messages to the CF Queue, which in turn starts ScoutWorkflow instances. The workflow runs durably with automatic retries across its 6 steps.\n\nAll endpoints inherit Bearer token authentication from the collection.",
			"item": [
				{
					"name": "Run Scout — Single Publication",
					"description": "Trigger the content scout for a single publication.\n\nEnqueues one message to the CF Queue with the given `publicationId`. The queue consumer will start a ScoutWorkflow instance that runs the full 6-step pipeline for that publication.\n\n### Request Body\n\n| Field | Type | Required | Description |\n|-------|------|----------|-------------|\n| `publicationId` | string | **Yes** | UUID of the publication to scout for. Must exist in the publications table. |\n\n### Response — Queued (200)\n\n```json\n{\n  \"queued\": true,\n  \"publicationId\": \"f47ac10b-58cc-4372-a567-0e02b2c3d479\"\n}\n```\n\nThe response confirms the message was enqueued. The actual scout workflow runs asynchronously — results will appear in the ideas table once the workflow completes.\n\n### Possible Errors\n\n- `400` — Missing or invalid `publicationId`\n- `401` — Missing or invalid Bearer token",
					"request": {
						"method": "POST",
						"header": [
							{ "key": "Content-Type", "value": "application/json" }
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"publicationId\": \"{{publicationId}}\"\n}"
						},
						"url": {
							"raw": "{{SCOUT_BASE_URL}}/api/scout/run",
							"host": ["{{SCOUT_BASE_URL}}"],
							"path": ["api", "scout", "run"]
						}
					},
					"response": [
						{
							"name": "200 — Queued",
							"status": "OK",
							"code": 200,
							"header": [
								{ "key": "Content-Type", "value": "application/json" }
							],
							"body": "{\n  \"queued\": true,\n  \"publicationId\": \"f47ac10b-58cc-4372-a567-0e02b2c3d479\"\n}"
						},
						{
							"name": "400 — Missing publicationId",
							"status": "Bad Request",
							"code": 400,
							"header": [
								{ "key": "Content-Type", "value": "application/json" }
							],
							"body": "{\n  \"error\": \"publicationId is required\"\n}"
						},
						{
							"name": "401 — Unauthorized",
							"status": "Unauthorized",
							"code": 401,
							"header": [
								{ "key": "Content-Type", "value": "application/json" }
							],
							"body": "{\n  \"error\": \"Unauthorized\"\n}"
						}
					]
				},
				{
					"name": "Run Scout — All Publications",
					"description": "Trigger the content scout for ALL active publications.\n\nQueries the DAL for every publication and enqueues one CF Queue message per publication. Each message starts its own ScoutWorkflow instance.\n\nThis is the same operation that the hourly cron trigger performs for due publications. Use this endpoint to trigger an immediate scout run for all publications, regardless of schedule.\n\n### Request Body\n\nNo body required.\n\n### Response — Queued (200)\n\n```json\n{\n  \"queued\": true,\n  \"count\": 5\n}\n```\n\n### Possible Errors\n\n- `401` — Missing or invalid Bearer token",
					"request": {
						"method": "POST",
						"header": [
							{ "key": "Content-Type", "value": "application/json" }
						],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "{{SCOUT_BASE_URL}}/api/scout/run-all",
							"host": ["{{SCOUT_BASE_URL}}"],
							"path": ["api", "scout", "run-all"]
						}
					},
					"response": [
						{
							"name": "200 — All publications queued",
							"status": "OK",
							"code": 200,
							"header": [
								{ "key": "Content-Type", "value": "application/json" }
							],
							"body": "{\n  \"queued\": true,\n  \"count\": 5\n}"
						},
						{
							"name": "200 — No publications found",
							"status": "OK",
							"code": 200,
							"header": [
								{ "key": "Content-Type", "value": "application/json" }
							],
							"body": "{\n  \"queued\": true,\n  \"count\": 0\n}"
						},
						{
							"name": "401 — Unauthorized",
							"status": "Unauthorized",
							"code": 401,
							"header": [
								{ "key": "Content-Type", "value": "application/json" }
							],
							"body": "{\n  \"error\": \"Unauthorized\"\n}"
						}
					]
				}
			]
		}
	]
}
