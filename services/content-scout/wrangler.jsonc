{
	"$schema": "node_modules/wrangler/config-schema.json",
	"name": "hotmetal-content-scout",
	"main": "src/index.ts",
	"compatibility_date": "2025-12-17",
	"compatibility_flags": ["nodejs_compat"],
	"observability": {
		"enabled": true,
	},

	"dev": {
		"port": 8790,
	},

	// Cron trigger — hourly, queries per-publication next_scout_at
	"triggers": {
		"crons": ["0 * * * *"],
	},

	// Durable workflow for multi-step scout pipeline
	"workflows": [
		{
			"name": "scout-workflow",
			"binding": "SCOUT_WORKFLOW",
			"class_name": "ScoutWorkflow",
		},
	],

	// Queue: fan-out 1 message per publication
	"queues": {
		"producers": [
			{
				"queue": "hotmetal-scout-queue",
				"binding": "SCOUT_QUEUE",
			},
		],
		"consumers": [
			{
				"queue": "hotmetal-scout-queue",
				"max_batch_size": 1,
				"max_retries": 3,
				"dead_letter_queue": "hotmetal-scout-dlq",
			},
		],
	},

	// KV namespace for Alexander API search result caching (24h TTL)
	"kv_namespaces": [
		{
			"binding": "SCOUT_CACHE",
			"id": "86047743f8c04bd398a79e94ed30d8d1",
		},
	],

	// Data Access Layer via Service Binding
	"services": [
		{
			"binding": "DAL",
			"service": "hotmetal-data-layer",
			"entrypoint": "DataLayer",
		},
	],
	"routes": [
		{
			"pattern": "scout.hotmetalapp.com",
			"zone_name": "hotmetalapp.com",
			"custom_domain": true,
		},
	],

	// Non-secret environment variables
	"vars": {
		"ALEXANDER_API_URL": "https://alexanderai.farfarawaylabs.com",
		"WRITER_AGENT_URL": "https://agent.hotmetalapp.com",
	},

	// Secrets (set via `wrangler secret put`):
	// API_KEY              — authenticates incoming requests to this service
	// ALEXANDER_API_KEY    — Alexander trend search API
	// ANTHROPIC_API_KEY    — Claude API for idea generation
	// WRITER_AGENT_API_KEY — key to call writer-agent (for auto-write)
}
