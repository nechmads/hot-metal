{
	"$schema": "node_modules/wrangler/config-schema.json",
	"name": "hotmetal-writer-agent",
	"main": "src/index.ts",
	"compatibility_date": "2026-02-05",
	"compatibility_flags": ["nodejs_compat"],
	"observability": {
		"enabled": true,
	},

	"dev": {
		"port": 8789,
	},

	// Durable Objects â€” one WriterAgent instance per writing session
	"durable_objects": {
		"bindings": [
			{
				"name": "WRITER_AGENT",
				"class_name": "WriterAgent",
			},
		],
	},

	// SQLite migrations for agent-local state (drafts, research_notes)
	"migrations": [
		{
			"tag": "v1",
			"new_sqlite_classes": ["WriterAgent"],
		},
	],

	// Service Binding to the Data Access Layer (replaces direct D1 access)
	"services": [
		{
			"binding": "DAL",
			"service": "hotmetal-data-layer",
			"entrypoint": "DataLayer",
		},
	],

	// Environment variables (non-secret)
	"vars": {
		"CMS_URL": "https://cms.hotmetalapp.com",
		"ALEXANDER_API_URL": "https://alexanderai.farfarawaylabs.com",
	},
	"routes": [
		{
			"pattern": "agent.hotmetalapp.com",
			"zone_name": "hotmetalapp.com",
			"custom_domain": true,
		},
	],

	// Workers AI binding (for image generation)
	"ai": { "binding": "AI" },

	// R2 bucket for generated images
	"r2_buckets": [
		{
			"binding": "IMAGE_BUCKET",
			"bucket_name": "hotmetal-cms-bucket",
		},
	],

	// Secrets (set via `wrangler secret put`):
	// ANTHROPIC_API_KEY, CMS_API_KEY, WRITER_API_KEY, ALEXANDER_API_KEY
}
